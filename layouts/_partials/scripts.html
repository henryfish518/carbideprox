{{ $needKaTeX  := or .Params.math .Site.Params.katex.enable .Params.chem .Site.Params.chem (.Page.Store.Get "hasKaTeX") (.Page.Store.Get "hasmhchem") -}}
{{ $needmhchem := or .Params.chem .Site.Params.katex.mhchem.enable (.Page.Store.Get "hasmhchem") -}}

{{ if .Site.Params.markmap.enable -}}
<style>
.markmap > svg {
  width: 100%;
  height: 300px;
}
</style>
<script>
window.markmap = {
  autoLoader: {
      manual: true,
      onReady() {
        const { autoLoader, builtInPlugins } = window.markmap;
        autoLoader.transformPlugins = builtInPlugins.filter(plugin => plugin.name !== 'prism');
      },
  },
};
</script>
<script src="https://cdn.jsdelivr.net/npm/markmap-autoloader"></script>
{{ end -}}

{{ if .Site.Params.plantuml.enable -}}
  <script src='{{ "js/deflate.js" | relURL }}'></script>
{{ end -}}

{{ if $needKaTeX -}}
  {{ partial "scripts/katex.html" (dict "mhchem" $needmhchem) -}}
{{ end -}}

{{ $jsBs := resources.Get "vendor/bootstrap/dist/js/bootstrap.bundle.js" -}}
{{ $jsBase := resources.Get "js/base.js" -}}
{{ $jsSearch := resources.Get "js/search.js" | resources.ExecuteAsTemplate "js/search.js" .Site.Home -}}
{{ $jsMarkmap := resources.Get "js/markmap.js" | resources.ExecuteAsTemplate "js/markmap.js" . -}}
{{ $jsPlantuml := resources.Get "js/plantuml.js" | resources.ExecuteAsTemplate "js/plantuml.js" . -}}
{{ $jsDrawio := resources.Get "js/drawio.js" | resources.ExecuteAsTemplate "js/drawio.js" . -}}
{{ if .Site.Params.offlineSearch -}}
  {{ $jsSearch = resources.Get "js/offline-search.js" -}}
{{ end -}}

{{ $jsArray := slice $jsBs $jsBase $jsSearch $jsPlantuml $jsMarkmap $jsDrawio -}}

{{ if .Page.Store.Get "hasmermaid" -}}
{{- partial "scripts/mermaid.html" . -}}
{{ end -}}

{{ if .Site.Params.ui.showLightDarkModeMenu -}}
  {{ $jsArray = $jsArray | append (resources.Get "js/dark-mode.js") -}}
{{ end -}}

{{ $js := $jsArray | resources.Concat "js/main.js" -}}
{{ if hugo.IsProduction -}}
  {{ $js := $js | minify | fingerprint -}}
  <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" crossorigin="anonymous"></script>
{{ else -}}
  <script src="{{ $js.RelPermalink }}"></script>
{{ end -}}

{{ if .Site.Params.prism_syntax_highlighting -}}
  <script src='{{ "js/prism.js" | relURL }}'></script>
{{ else if ( not .Site.Params.disable_click2copy_chroma ) -}}
  {{ $c2cJS := resources.Get "js/click-to-copy.js" -}}
  {{ if hugo.IsProduction -}}
    {{ $c2cJS = $c2cJS | minify | fingerprint -}}
  {{ end -}}
  <script defer src="{{ $c2cJS.RelPermalink }}" {{ with $c2cJS.Data.Integrity -}}
    integrity="{{ . }}" {{ end -}}
    crossorigin="anonymous"></script>
{{ end -}}

{{ if and .Site.Params.search (isset .Site.Params.search "algolia") -}}
  {{ template "algolia/scripts" .Site.Params.search.algolia -}}
{{ end -}}
<script src='{{ "js/tabpane-persist.js" | relURL }}'></script>
{{ partial "hooks/body-end.html" . -}}

{{ define "algolia/scripts" -}}
<script src='{{ "js/docsearch.js" | relURL }}'></script>
<script type="text/javascript">
const containers = ['#docsearch-0', '#docsearch-1'];
for (let c of containers) {
  docsearch({
    container: c,
    appId: {{ .appId | default "P0DO4BA8CK" }},
    apiKey: {{ .apiKey | default "d1faae509f380cf8e70b21d75dfe6e87" }},
    indexName: {{ .indexName | default "hugo" }},
    askAi: {{ .askAi | default "bX4Pdh32pzMP" }},
    
    translations: {
    button: {
      buttonText: '搜索',
      buttonAriaLabel: '搜索',
    },
    modal: {
      searchBox: {
        clearButtonTitle: '清除查询条件',
        clearButtonAriaLabel: '清除查询条件',
        closeButtonText: '关闭',
        closeButtonAriaLabel: '关闭',
        placeholderText: '搜索 或 向AI提问', // fallback: 'Search docs' or 'Search docs or ask AI a question'
        placeholderTextAskAi: '向 AI 提问：', // fallback: 'Ask another question...'
        placeholderTextAskAiStreaming: '回答中...', // can only be one of the following
        // https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Global_attributes/enterkeyhint#value
        enterKeyHint: '搜索',
        enterKeyHintAskAi: '输入',
        searchInputLabel: '搜索',
        backToKeywordSearchButtonText: '返回关键字搜索',
        backToKeywordSearchButtonAriaLabel: '返回关键字搜索',
      },
      startScreen: {
        recentSearchesTitle: '搜索历史',
        noRecentSearchesText: '没有搜索历史',
        saveRecentSearchButtonTitle: '保存至搜索历史',
        removeRecentSearchButtonTitle: '从搜索历史中移除',
        favoriteSearchesTitle: '收藏',
        removeFavoriteSearchButtonTitle: '从收藏中移除',
        recentConversationsTitle: '最近的对话',
        removeRecentConversationButtonTitle: '从历史记录中删除对话',
      },
      errorScreen: {
        titleText: '无法获取结果',
        helpText: '你可能需要检查你的网络连接',
      },
      noResultsScreen: {
        noResultsText: '无法找到相关结果',
        suggestedQueryText: '你可以尝试查询',
        reportMissingResultsText: '你认为该查询应该有结果？',
        reportMissingResultsLinkText: '点击反馈',
      },
      resultsScreen: {
        askAiPlaceholder: '向 AI 提问：',
      },
      askAiScreen: {
        disclaimerText: '答案由 AI 生成，可能不准确，请自行验证。',
        relatedSourcesText: '相关来源',
        thinkingText: '思考中...',
        copyButtonText: '复制',
        copyButtonCopiedText: '已复制！',
        copyButtonTitle: '复制',
        likeButtonTitle: '赞',
        dislikeButtonTitle: '踩',
        thanksForFeedbackText: '感谢你的反馈！',
        preToolCallText: '搜索中...',
        duringToolCallText: '搜索 ',
        afterToolCallText: '已搜索',
        // If provided, these override the default rendering of aggregated tool calls:
        aggregatedToolCallNode: undefined, // (queries: string[], onSearchQueryClick: (query: string) => void) => React.ReactNode
        aggregatedToolCallText: '已搜索', // (queries: string[]) => { before?: string; separator?: string; lastSeparator?: string; after?: string }
      },
      footer: {
        selectText: '选择',
        submitQuestionText: '提交问题',
        selectKeyAriaLabel: 'Enter 键',
        navigateText: '切换',
        navigateUpKeyAriaLabel: '向上箭头',
        navigateDownKeyAriaLabel: '向下箭头',
        closeText: '关闭',
        backToSearchText: '返回搜索',
        closeKeyAriaLabel: 'Esc 键',
        poweredByText: '',
      },
    },
  },
  });
}
</script>
{{ end -}}
