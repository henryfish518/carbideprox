<div class="article-page">
    
    <!-- 文章头部信息 -->
    <div class="article-header">
        <div class="container">
            <h1 class="article-title">{{ .Title }}</h1>
            {{ with .Params.description }}<div class="article-subtitle">{{ . | markdownify }}</div>{{ end }}
            
            <div class="article-meta">
                <div class="meta-items">
                    {{ with .Params.author }}
                    <div class="meta-item">
                        <i class="fas fa-user"></i>
                        <span>{{ . | markdownify }}</span>
                    </div>
                    {{ end }}
                    
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <time datetime="{{  $.Date.Format "2006-01-02" }}">{{ $.Date.Format $.Site.Params.time_format_blog  }}</time>
                    </div>
                    
                    <div class="meta-item">
                        <i class="fas fa-eye"></i>
                        <span>阅读量: <span id="article-views">-</span></span>
                    </div>
                </div>
                
                <!-- 封面图片 -->
                {{ $image := .Params.image | default .Params.featured_image }}
                {{ if $image }}
                <div class="article-cover">
                    <img src="{{ $image }}" alt="{{ .Title }}" loading="lazy" />
                </div>
                {{ end }}
            </div>
        </div>
    </div>

    <!-- 面包屑导航 -->
    {{ partial "breadcrumb-article.html" . }}

    <!-- 主要内容区域 -->
    <div class="article-main-content">
        <div class="container">
            <div class="article-layout">
                <!-- 文章内容 -->
                <div class="article-content">
                    <!-- Tab导航 -->
                    <div class="article-tabs">
                        <nav class="tab-nav">
                            <button class="tab-btn active" data-tab="content">详情介绍</button>
                            <button class="tab-btn" data-tab="faq">常见问题</button>
                            <button class="tab-btn" data-tab="comments">评论建议</button>
                        </nav>
                        
                        <!-- 内容详情 -->
                        <div class="tab-content active" id="tab-content">
                            <div class="article-body">
                                {{ .Content }}
                            </div>
                            
                            <!-- 功能特性列表 -->
                            {{ if .Params.features }}
                            <div class="features-section">
                                <h3>功能特性</h3>
                                <ul class="features-list">
                                    {{ range .Params.features }}
                                    <li><i class="fas fa-check"></i>{{ . }}</li>
                                    {{ end }}
                                </ul>
                            </div>
                            {{ end }}
                        </div>
                        
                        <!-- 常见问题 -->
                        <div class="tab-content" id="tab-faq">
                            <div class="faq-section">
                                <h3>常见问题</h3>
                                <div class="faq-list">
                                    <div class="faq-item">
                                        <h4>Q: 这个资源的商业用途是什么？</h4>
                                        <p>A: 本资源仅供个人学习使用，商业用途需要联系作者授权。</p>
                                    </div>
                                    <div class="faq-item">
                                        <h4>Q: 下载后如何安装使用？</h4>
                                        <p>A: 请参考文章中的详细安装教程，如有问题可以在评论区留言。</p>
                                    </div>
                                    <div class="faq-item">
                                        <h4>Q: 遇到技术问题怎么办？</h4>
                                        <p>A: 欢迎在评论区提出您的问题，我们会尽快回复解答。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 评论区域 -->
                        <div class="tab-content" id="tab-comments">
                            <div class="comments-section">
                                <h3>评论建议</h3>
                                {{ if (.Site.Config.Services.Disqus.Shortname) }}
                                    {{- partial "disqus-comment.html" . -}}
                                {{ else }}
                                    <p>评论功能暂未开启，如需交流请通过其他方式联系我们。</p>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 文章标签 -->
                    <div class="article-tags">
                        <span class="tags-label">标签:</span>
                        {{ range .Params.tags }}
                        <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
                        {{ end }}
                    </div>
                    
                    <!-- 相关文章推荐 -->
                    <div class="related-articles">
                        <h3 class="section-title">相关推荐</h3>
                        <div class="related-grid">
                            {{ $related := .Site.RegularPages.Related . | first 4 }}
                            {{ with $related }}
                            {{ range . }}
                            <article class="related-card">
                                {{ $relatedImage := .Params.image | default .Params.featured_image }}
                                {{ if $relatedImage }}
                                <div class="related-image">
                                    <img src="{{ $relatedImage }}" alt="{{ .Title }}" loading="lazy" />
                                </div>
                                {{ end }}
                                <div class="related-content">
                                    <h4><a href="{{ .RelPermalink }}">{{ .Title }}</a></h4>
                                    <p class="related-excerpt">{{ .Description | default (truncate 60 .Summary) }}</p>
                                    <div class="related-meta">
                                        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time>
                                        <span class="related-views">{{ .ReadingTime }}分钟阅读</span>
                                    </div>
                                </div>
                            </article>
                            {{ end }}
                            {{ else }}
                            <p class="no-related">暂无相关文章</p>
                            {{ end }}
                        </div>
                    </div>
                </div>
                
                <!-- 右侧分类导航 -->
                <aside class="article-sidebar">
                    {{ partial "categories-sidebar.html" . }}
                </aside>
            </div>
        </div>
    </div>
</div>
    </div>

    <!-- 文章右侧分类导航 -->
    <div class="article-sidebar">
        <div class="container">
            {{ partial "categories-sidebar.html" . }}
        </div>
    </div>
</div>

<script>
// 移动端优化 - JavaScript交互功能
document.addEventListener('DOMContentLoaded', function() {
    // Tab切换功能
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // 移除所有激活状态
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // 添加当前激活状态
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            // 移动端滚动到顶部
            if (window.innerWidth <= 768) {
                const tabNav = document.querySelector('.tab-nav');
                if (tabNav) {
                    tabNav.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }
        });
        
        // 触摸优化
        btn.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
        });
        
        btn.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
    });
    
    // 移动端导航栏交互
    const navbar = document.querySelector('.navbar');
    let lastScrollY = window.scrollY;
    
    if (window.innerWidth <= 768 && navbar) {
        window.addEventListener('scroll', function() {
            const currentScrollY = window.scrollY;
            
            if (currentScrollY > lastScrollY && currentScrollY > 100) {
                // 向下滚动，隐藏导航栏
                navbar.style.transform = 'translateY(-100%)';
                navbar.style.transition = 'transform 0.3s ease';
            } else {
                // 向上滚动或顶部，显示导航栏
                navbar.style.transform = 'translateY(0)';
            }
            
            lastScrollY = currentScrollY;
        });
    }
    
    // 图片懒加载优化
    const images = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.getAttribute('data-src');
                img.classList.add('loaded');
                observer.unobserve(img);
            }
        });
    });
    
    images.forEach(img => imageObserver.observe(img));
    
    // 移动端触摸优化
    const touchElements = document.querySelectorAll('.article-card, .related-card, .resource-card');
    touchElements.forEach(element => {
        element.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
            this.style.transition = 'transform 0.1s ease';
        });
        
        element.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
        });
        
        element.addEventListener('touchcancel', function() {
            this.style.transform = 'scale(1)';
        });
    });
    
    // 移动端滚动性能优化
    let ticking = false;
    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(function() {
                // 滚动时优化性能
                document.body.classList.add('scrolling');
                ticking = false;
            });
            ticking = true;
        }
    });
    
    // 滚动结束检测
    let scrollTimeout;
    window.addEventListener('scroll', function() {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(function() {
            document.body.classList.remove('scrolling');
        }, 100);
    });
    
    // 移动端菜单交互
    const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
            const isActive = this.classList.contains('active');
            
            if (isActive) {
                this.classList.remove('active');
                mobileMenu.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                this.classList.add('active');
                mobileMenu.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });
        
        // 关闭菜单
        const closeMenu = () => {
            mobileMenuToggle.classList.remove('active');
            mobileMenu.classList.remove('active');
            document.body.style.overflow = '';
        };
        
        // 点击菜单外部关闭
        mobileMenu.addEventListener('click', function(e) {
            if (e.target === mobileMenu) {
                closeMenu();
            }
        });
        
        // ESC键关闭
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMenu();
            }
        });
    }
    
    // 视口检测和优化
    function checkViewport() {
        const isMobile = window.innerWidth <= 768;
        document.body.classList.toggle('mobile-view', isMobile);
        document.body.classList.toggle('desktop-view', !isMobile);
        
        // 移动端特定优化
        if (isMobile) {
            // 禁用不需要的动画
            document.documentElement.style.setProperty('--animation-duration', '0.3s');
            
            // 优化字体大小
            const baseFontSize = Math.max(14, Math.min(16, window.innerWidth / 24));
            document.documentElement.style.fontSize = baseFontSize + 'px';
        }
    }
    
    // 初始检查和监听
    checkViewport();
    window.addEventListener('resize', checkViewport);
    window.addEventListener('orientationchange', checkViewport);
});

// 性能监控和优化
if ('performance' in window) {
    // 页面加载性能监控
    window.addEventListener('load', function() {
        const perfData = performance.timing;
        const loadTime = perfData.loadEventEnd - perfData.navigationStart;
        
        // 移动端加载时间优化
        if (loadTime > 3000) {
            console.warn('页面加载时间较长，建议优化移动端性能');
        }
    });
}

// 移动端内存优化
if (window.innerWidth <= 768) {
    // 清理不必要的事件监听器
    window.addEventListener('beforeunload', function() {
        // 清理定时器
        const highestTimeoutId = setTimeout(() => {});
        for (let i = 0; i < highestTimeoutId; i++) {
            clearTimeout(i);
            clearInterval(i);
        }
    });
}
</script>
